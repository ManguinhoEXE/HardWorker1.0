<!-- ==================== 1. SIDEBAR PRINCIPAL ==================== -->
<div class="d-flex flex-column align-items-center sidebar">

  <!-- 1.1 Botón de cierre de sesión -->
  <button class="btn btn-danger" (click)="logout()">
    <i class="fas fa-sign-out-alt"></i>
  </button>

  <!-- ==================== 2. SECCIÓN DE PERFIL ==================== -->
  <div class="profile-image-container">
    <img [src]="profileImage || defaultProfileImage" alt="Profile Image" class="profile-image"
      (click)="fileInput.click()" (error)="onImageError($event)" />
    <input type="file" #fileInput (change)="onFileSelected($event)" hidden />
  </div>

  <!-- Nombre del usuario -->
  <p class="text-white fw-bold mt-2">{{firstName}} {{lastName}}</p>

  <!-- ==================== 3. NAVEGACIÓN DINÁMICA ==================== -->
  <nav class="nav flex-column">

    <!-- Usuario -->
    <ng-container *ngIf="isUser()">
      <button class="btn btn-light w-100 my-1" routerLink="/inicio" routerLinkActive="active-nav-button">
        <i class="fas fa-clock me-2"></i>
        Mis Horas
      </button>
      <button class="btn btn-secondary w-100 my-1" routerLink="/tablero" routerLinkActive="active-nav-button-board">
        <i class="fas fa-user me-2"></i>
        Tablero
      </button>
    </ng-container>

    <!-- Admin -->
    <ng-container *ngIf="isAdmin()">
      <button class="btn btn-light w-100 my-1" routerLink="/inicio" routerLinkActive="active-nav-button">
        <i class="fas fa-users me-2"></i>
        Usuarios
      </button>
      <button class="btn btn-secondary w-100 my-1" routerLink="/tablero" routerLinkActive="active-nav-button-board">
        <i class="fas fa-chart-dashboard me-2"></i>
        Tablero
      </button>
    </ng-container>

    <!-- Super Admin -->
    <ng-container *ngIf="isSuper()">
      <button class="btn btn-light w-100 my-1" routerLink="/superadmin" routerLinkActive="active-nav-button">
        <i class="fas fa-users-cog me-2"></i>
        Usuarios
      </button>
      <button class="btn btn-secondary w-100 my-1" routerLink="/registro" routerLinkActive="active-nav-button">
        <i class="fas fa-user-plus me-2"></i>
        Crear
      </button>
    </ng-container>

    <!-- ==================== 4. ÁREA DE NOTIFICACIONES ==================== -->
    <div class="d-flex justify-content-center align-items-center mt-2">
      <div class="card info-card p-3 shadow">

        <!-- Lista de notificaciones -->
        <div *ngFor="let n of notifications" class="card p-2 shadow notification-card mb-3 position-relative"
          [class.disabled]="!isActionableNotification(n.type) && userRole === 'Admin'"
          [style.cursor]="getNotificationCursor(n)" (click)="openModal(n)">

          <span class="status-dot position-absolute" [class.read]="n.isRead" [class.unread]="!n.isRead"></span>
          <!-- Encabezado -->
          <h6 class="fw-bold mb-1">
            {{ n.firstName }} {{ n.lastName }}
          </h6>

          <!-- Contenido dinámico por tipo -->
          <p [innerHTML]="getNotificationContent(n)"></p>
        </div>
      </div>
    </div>
  </nav>
</div>

<!-- ==================== 5. MODAL DE NOTIFICACIONES ==================== -->
<div *ngIf="selectedNotification" class="modal-overlay" (click)="closeModal()">
  <div class="modal-content notification-modal" (click)="$event.stopPropagation()">

    <!-- Cabecera del modal -->
    <div class="modal-header">
      <h3>
        <i [class]="getModalIcon()"></i>
        {{ getModalTitle() }}
      </h3>
      <button class="btn-close" (click)="closeModal()">
        <i class="bi bi-x"></i>
      </button>
    </div>

    <!-- Contenido del modal -->
    <div class="modal-body">
      <h5 class="fw-bold mb-3 text-center">{{ getModalTitle() }}</h5>
      <h6>{{ selectedNotification.firstName }} {{ selectedNotification.lastName }}</h6>
      <p [innerHTML]="getModalContent()"></p>
    </div>

    <!-- Footer con botones de acción -->
    <div class="modal-actions" *ngIf="isActionableNotification(selectedNotification.type)">
      <button class="btn btn-danger" (click)="rejectRequest()">
        <i class="fas fa-times-circle"></i>
        Rechazar
      </button>
      <button class="btn btn-success" (click)="acceptRequest()">
        <i class="fas fa-check-circle"></i>
        Aceptar
      </button>
    </div>
  </div>
</div>